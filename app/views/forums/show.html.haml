= form_tag(:controller => :forums, :action => 'search', :method => "get", :forum_id => @forum.id) do
  = label_tag(:search_term, "Search forum:")
  = text_field_tag(:search_term)
  = submit_tag("Search")

- @posts.each do |post|
  .forum_post_container
    .forum_post
      - if post.user_id == current_user.id
        = link_to "delete", {:controller => :posts, :action => 'destroy', :post_id => post.id, :forum_id => @forum.id }, :method => :delete, :class => "delete_link"
      %h3
        = link_to post.title, post_path(post)
      %p
        = post.content
      %div.bottom 
        Originally posted #{post.created_at.strftime("%B %e, %Y")} by #{link_to post.user.login, post.user} #{post.tag_list.map {|tag| "#"  + tag}.join(" ")}
        %br
        Last updated #{ time_ago_in_words(post.last_updated.to_time, include_seconds = true)} ago
    .forum_post_responses
      - (post.comments.sort { |c1, c2| c2.rating(current_user.id) <=> c1.rating(current_user.id) }).each do |comment|
        .response
          .up-down-widget
            = link_to "+", {:controller => :comments,:action => 'plus1', :comment_id => comment.id}, :method => :post, :class => "udw-top"
            %span.udw-middle= comment.rating(current_user.id)
            = link_to "-", {:controller => :comments,:action => 'minus1', :comment_id => comment.id}, :method => :post, :class => "udw-bottom"
          - if comment.user_id == current_user.id
            = link_to "delete", {:controller => :comments, :action => 'destroy', :comment_id => comment.id, :forum_id => @forum.id }, :method => :delete, :class => "delete_link"
          %h4= link_to @user.login, user_path(@user)
          %p= comment.content
          %br

          - (comment.subcomments.sort { |c1, c2| c1.created_at <=> c2.created_at }).each do |subcomment|
            = link_to @user.login, user_path(@user)
            = subcomment.content
            - if subcomment.user_id == @user.id
              = link_to "Delete comment", {:controller => :subcomments, :action => 'destroy', :subcomment_id => subcomment.id}, :method => :delete
            %br
          = render :partial => "newSubcomment", :locals => { :comment => comment }
      .post_response_form
        = render :partial => "newComment", :locals => { :post => post }
= render :partial => "newPost"
